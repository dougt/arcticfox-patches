# HG changeset patch
# User Ted Mielczarek <ted.mielczarek@gmail.com>
# Date 1288962717 14400
# Node ID 815473412df99d130b0fa5818aedc353be0ff2d8
# Parent  c8acf54b982ad73b596450053ee6da66a8be04a2
imported patch struct-stat64

diff --git a/configure.in b/configure.in
--- a/configure.in
+++ b/configure.in
@@ -3820,6 +3820,17 @@
 AC_CHECK_FUNCS(flockfile getpagesize)
 AC_CHECK_FUNCS(localtime_r strtok_r)
 
+dnl check for struct stat64
+if test "$ac_cv_func_stat64" = "yes"; then
+  AC_TRY_COMPILE([#include <sys/stat.h>],
+                 [struct stat64 st;],
+                 ac_cv_struct_stat64=yes,
+                 ac_cv_struct_stat64=no)
+  if test "$ac_cv_struct_stat64" = "yes"; then
+    AC_DEFINE(HAVE_STRUCT_STAT64)
+  fi
+fi
+
 dnl check for clock_gettime(), the CLOCK_MONOTONIC clock, and -lrt
 _SAVE_LDFLAGS=$LDFLAGS
 LDFLAGS="$LDFLAGS -lrt"
diff --git a/xpcom/io/nsLocalFileUnix.h b/xpcom/io/nsLocalFileUnix.h
--- a/xpcom/io/nsLocalFileUnix.h
+++ b/xpcom/io/nsLocalFileUnix.h
@@ -89,7 +89,7 @@
     #include <sys/mount.h>
 #endif
 
-#if defined(HAVE_STAT64) && defined(HAVE_LSTAT64)
+#if defined(HAVE_STAT64) && defined(HAVE_LSTAT64) && defined(HAVE_STRUCT_STAT64)
     #if defined (AIX)
         #if defined STAT
             #undef STAT
