# HG changeset patch
# User Ted Mielczarek <ted.mielczarek@gmail.com>
# Date 1272373063 14400
# Node ID 685b4c39f79956d0e2466786f517e5f47c9b4206
# Parent  fb6d23354efa54301c8aecca316eff5883d5066a
imported patch script-security-manager-plugins

diff --git a/caps/src/nsScriptSecurityManager.cpp b/caps/src/nsScriptSecurityManager.cpp
--- a/caps/src/nsScriptSecurityManager.cpp
+++ b/caps/src/nsScriptSecurityManager.cpp
@@ -72,7 +72,9 @@
 #include "nsIFile.h"
 #include "nsIFileURL.h"
 #include "nsIZipReader.h"
+#ifdef MOZ_PLUGINS
 #include "nsIPluginInstance.h"
+#endif
 #include "nsIXPConnect.h"
 #include "nsIScriptGlobalObject.h"
 #include "nsPIDOMWindow.h"
@@ -3229,6 +3231,7 @@
         }
     }
 
+#ifdef MOZ_PLUGINS
     //-- If user allows scripting of plugins by untrusted scripts,
     //   and the target object is a plugin, allow the access.
     if(aObj)
@@ -3249,6 +3252,7 @@
                 return NS_OK;
         }
     }
+#endif
 
     //-- Access tests failed
     return NS_ERROR_DOM_XPCONNECT_ACCESS_DENIED;
