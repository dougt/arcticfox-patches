# HG changeset patch
# User Ted Mielczarek <ted.mielczarek@gmail.com>
# Date 1272373063 14400
# Node ID 2d465b4a4aa2622f55182ccfea63ba2536b7f16b
# Parent  68b08e695cf1213f5667886b498a94c6c52b5d09
imported patch script-security-manager-plugins

diff --git a/caps/src/nsScriptSecurityManager.cpp b/caps/src/nsScriptSecurityManager.cpp
--- a/caps/src/nsScriptSecurityManager.cpp
+++ b/caps/src/nsScriptSecurityManager.cpp
@@ -71,7 +71,9 @@
 #include "nsIFile.h"
 #include "nsIFileURL.h"
 #include "nsIZipReader.h"
+#ifdef MOZ_PLUGINS
 #include "nsIPluginInstance.h"
+#endif
 #include "nsIXPConnect.h"
 #include "nsIScriptGlobalObject.h"
 #include "nsPIDOMWindow.h"
@@ -3237,6 +3239,7 @@
         }
     }
 
+#ifdef MOZ_PLUGINS
     //-- If user allows scripting of plugins by untrusted scripts,
     //   and the target object is a plugin, allow the access.
     if(aObj)
@@ -3257,6 +3260,7 @@
                 return NS_OK;
         }
     }
+#endif
 
     //-- Access tests failed
     return NS_ERROR_DOM_XPCONNECT_ACCESS_DENIED;
