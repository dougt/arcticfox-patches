# HG changeset patch
# User Ted Mielczarek <ted.mielczarek@gmail.com>
# Date 1272373063 14400
# Node ID 311bbe2a4221f71d0c5b94807193275d053c1b5c
# Parent  c5cb5aee23b991c237471837e26185c87a199edb
imported patch script-security-manager-plugins

diff --git a/caps/src/nsScriptSecurityManager.cpp b/caps/src/nsScriptSecurityManager.cpp
--- a/caps/src/nsScriptSecurityManager.cpp
+++ b/caps/src/nsScriptSecurityManager.cpp
@@ -72,7 +72,9 @@
 #include "nsIFile.h"
 #include "nsIFileURL.h"
 #include "nsIZipReader.h"
+#ifdef MOZ_PLUGINS
 #include "nsIPluginInstance.h"
+#endif
 #include "nsIXPConnect.h"
 #include "nsIScriptGlobalObject.h"
 #include "nsPIDOMWindow.h"
@@ -3238,6 +3240,7 @@
         }
     }
 
+#ifdef MOZ_PLUGINS
     //-- If user allows scripting of plugins by untrusted scripts,
     //   and the target object is a plugin, allow the access.
     if(aObj)
@@ -3258,6 +3261,7 @@
                 return NS_OK;
         }
     }
+#endif
 
     //-- Access tests failed
     return NS_ERROR_DOM_XPCONNECT_ACCESS_DENIED;
