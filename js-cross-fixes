# HG changeset patch
# User Ted Mielczarek <ted.mielczarek@gmail.com>
# Date 1271867166 14400
# Node ID 7e37d7cae2e7a05e6a03a533b7b5ca483848c2e6
# Parent  290b99b430e46bb95caa8aede2e825a2976305cc
fixes for compiling js for iphone simulator

diff --git a/js/src/configure.in b/js/src/configure.in
--- a/js/src/configure.in
+++ b/js/src/configure.in
@@ -1720,11 +1720,29 @@
     STRIP="$STRIP -x -S"
     _PLATFORM_DEFAULT_TOOLKIT='cairo-cocoa'
     TARGET_NSPR_MDCPUCFG='\"md/_darwin.cfg\"'
+    # Check if we have the Cocoa framework, or if we're targeting Cocoa Touch
+    _SAVE_LDFLAGS=$LDFLAGS
+    #XXX: does spidermonkey need to link with Cocoa?
     LDFLAGS="$LDFLAGS -framework Cocoa"
+    AC_TRY_LINK(,[return 0;],_HAVE_FRAMEWORK_COCOA=1,_HAVE_FRAMEWORK_COCOA=)
+    if test -z "$_HAVE_FRAMEWORK_COCOA"; then
+        echo "Not using Cocoa"
+        LDFLAGS=$_SAVE_LDFLAGS;
+    fi
     # The ExceptionHandling framework is needed for Objective-C exception
     # logging code in nsObjCExceptions.h. Currently we only use that in debug
     # builds.
-    MOZ_DEBUG_LDFLAGS="$MOZ_DEBUG_LDFLAGS -framework ExceptionHandling"
+    _SAVE_LDFLAGS=$LDFLAGS
+     AC_MSG_CHECKING([for -framework ExceptionHandling])
+    LDFLAGS="$LDFLAGS -framework ExceptionHandling"
+    AC_TRY_LINK(,[return 0;],
+                ac_cv_have_framework_exceptionhandling="yes",
+                ac_cv_have_framework_exceptionhandling="no")
+    AC_MSG_RESULT([$ac_cv_have_framework_exceptionhandling])
+    if test  "$ac_cv_have_framework_exceptionhandling" = "yes"; then
+      MOZ_DEBUG_LDFLAGS="$MOZ_DEBUG_LDFLAGS -framework ExceptionHandling";
+    fi
+    LDFLAGS=$_SAVE_LDFLAGS
 
     dnl DTrace and -dead_strip don't interact well. See bug 403132.
     dnl ===================================================================
diff --git a/js/src/jscpucfg.cpp b/js/src/jscpucfg.cpp
--- a/js/src/jscpucfg.cpp
+++ b/js/src/jscpucfg.cpp
@@ -45,7 +45,7 @@
 #include <stdlib.h>
 
 #if defined(CROSS_COMPILE) && !defined(FORCE_BIG_ENDIAN) && !defined(FORCE_LITTLE_ENDIAN)
-#include <prtypes.h>
+//#include <prtypes.h>
 #endif
 
 /************************************************************************/
