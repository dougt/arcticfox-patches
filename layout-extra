# HG changeset patch
# User Ted Mielczarek <ted.mielczarek@gmail.com>
# Date 1289971661 18000
# Node ID 72cd09d2c5a0e1436b91ce9f911ccc2dd7143842
# Parent  db96c5705f55b74a165a4e4ff341313739bdecc4
imported patch layout-extra

diff --git a/layout/build/nsLayoutModule.cpp b/layout/build/nsLayoutModule.cpp
--- a/layout/build/nsLayoutModule.cpp
+++ b/layout/build/nsLayoutModule.cpp
@@ -285,12 +285,15 @@
 #endif
 
 #include "nsGeolocation.h"
+//XXX: bug 575206
+#ifndef MOZ_WIDGET_UIKIT
 #if defined(XP_UNIX)    || \
     defined(_WINDOWS)   || \
     defined(machintosh) || \
     defined(android)
 #include "nsAccelerometerSystem.h"
 #endif
+#endif
 #include "nsCSPService.h"
 
 // Transformiix
@@ -323,12 +326,15 @@
 NS_GENERIC_FACTORY_SINGLETON_CONSTRUCTOR(nsDOMStorageManager,
                                          nsDOMStorageManager::GetInstance)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsChannelPolicy)
+//XXX bug 575206
+#ifndef MOZ_WIDGET_UIKIT
 #if defined(XP_UNIX)    || \
     defined(_WINDOWS)   || \
     defined(machintosh) || \
     defined(android)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsAccelerometerSystem)
 #endif
+#endif
 
 //-----------------------------------------------------------------------------
 
@@ -881,12 +887,15 @@
 NS_DEFINE_NAMED_CID(NS_NULLPRINCIPAL_CID);
 NS_DEFINE_NAMED_CID(NS_SECURITYNAMESET_CID);
 
+//XXX bug 575206
+#ifndef MOZ_WIDGET_UIKIT
 #if defined(XP_UNIX)    || \
     defined(_WINDOWS)   || \
     defined(machintosh) || \
     defined(android)
 NS_DEFINE_NAMED_CID(NS_ACCELEROMETER_CID);
 #endif
+#endif
 
 static const mozilla::Module::CIDEntry kLayoutCIDs[] = {
   XPCONNECT_CIDENTRIES
@@ -1030,12 +1039,15 @@
   { &kNS_SYSTEMPRINCIPAL_CID, false, NULL, nsSystemPrincipalConstructor },
   { &kNS_NULLPRINCIPAL_CID, false, NULL, nsNullPrincipalConstructor },
   { &kNS_SECURITYNAMESET_CID, false, NULL, nsSecurityNameSetConstructor },
+//XXX bug 575206
+#ifndef MOZ_WIDGET_UIKIT
 #if defined(XP_UNIX)    || \
     defined(_WINDOWS)   || \
     defined(machintosh) || \
     defined(android)
   { &kNS_ACCELEROMETER_CID, false, NULL, nsAccelerometerSystemConstructor },
 #endif
+#endif
   { NULL }
 };
 
@@ -1175,12 +1187,15 @@
   { NS_SYSTEMPRINCIPAL_CONTRACTID, &kNS_SYSTEMPRINCIPAL_CID },
   { NS_NULLPRINCIPAL_CONTRACTID, &kNS_NULLPRINCIPAL_CID },
   { NS_SECURITYNAMESET_CONTRACTID, &kNS_SECURITYNAMESET_CID },
+//XXX bug 575206
+#ifndef MOZ_WIDGET_UIKIT
 #if defined(XP_UNIX)    || \
     defined(_WINDOWS)   || \
     defined(machintosh) || \
     defined(android)
   { NS_ACCELEROMETER_CONTRACTID, &kNS_ACCELEROMETER_CID },
 #endif
+#endif
   { NULL }
 };
 
diff --git a/layout/generic/nsObjectFrame.cpp b/layout/generic/nsObjectFrame.cpp
--- a/layout/generic/nsObjectFrame.cpp
+++ b/layout/generic/nsObjectFrame.cpp
@@ -464,8 +464,8 @@
   NP_Port                                   mQDPluginPortCopy;
 #endif
   PRInt32                                   mInCGPaintLevel;
+#ifdef MOZ_WIDGET_COCOA
   nsIOSurface                              *mIOSurface;
-#ifdef MOZ_WIDGET_COCOA
   nsCARenderer                              mCARenderer;
 #endif
   static nsCOMPtr<nsITimer>                *sCATimer;
@@ -2506,7 +2506,9 @@
 #endif
   mInCGPaintLevel = 0;
   mSentInitialTopLevelWindowEvent = PR_FALSE;
+#ifdef MOZ_WIDGET_COCOA
   mIOSurface = nsnull;
+#endif
   mPluginPortChanged = PR_FALSE;
 #endif
   mContentFocused = PR_FALSE;
