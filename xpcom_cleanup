diff --git a/build/iphone-xulrunner-mozconfig b/build/iphone-xulrunner-mozconfig
--- a/build/iphone-xulrunner-mozconfig
+++ b/build/iphone-xulrunner-mozconfig
@@ -1,6 +1,7 @@
 mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/../objdir-iphone-debug
 ac_add_options --enable-application=xulrunner
 
+export IPHONE=1
 
 export CROSS_COMPILE=1
 
diff --git a/config/autoconf.mk.in b/config/autoconf.mk.in
--- a/config/autoconf.mk.in
+++ b/config/autoconf.mk.in
@@ -619,6 +619,8 @@
 MOZ_XUL_APP	= @MOZ_XUL_APP@
 WINCE		= @WINCE@
 
+IPHONE      = @IPHONE@
+
 MOZ_DISTRIBUTION_ID = @MOZ_DISTRIBUTION_ID@
 
 NS_OSSO 	= @NS_OSSO@
diff --git a/configure.in b/configure.in
--- a/configure.in
+++ b/configure.in
@@ -7888,6 +7888,7 @@
 AC_SUBST(MOZ_POST_PROGRAM_COMMAND)
 AC_SUBST(MOZ_TIMELINE)
 AC_SUBST(WINCE)
+AC_SUBST(IPHONE)
 AC_SUBST(TARGET_DEVICE)
 
 AC_SUBST(MOZ_APP_NAME)
@@ -8076,6 +8077,11 @@
   AC_DEFINE(XP_UNIX)
   AC_DEFINE(UNIX_ASYNC_DNS)
   MOZ_MOVEMAIL=1
+
+  if test "$IPHONE"; then
+    AC_DEFINE(IPHONE)
+  fi
+
 elif test "$OS_ARCH" = "OpenVMS"; then
   AC_DEFINE(XP_UNIX)
 elif test "$OS_ARCH" != "WINNT" -a "$OS_ARCH" != "OS2" -a "$OS_ARCH" != "WINCE"; then
diff --git a/xpcom/glue/nsGREGlue.cpp b/xpcom/glue/nsGREGlue.cpp
--- a/xpcom/glue/nsGREGlue.cpp
+++ b/xpcom/glue/nsGREGlue.cpp
@@ -57,7 +57,7 @@
 # define INCL_DOS
 # include <os2.h>
 #elif defined(XP_MACOSX)
-# include <CFBundle.h>
+# include <CoreFoundation/CFBundle.h>
 # include <unistd.h>
 # include <dirent.h>
 #elif defined(XP_UNIX)
diff --git a/xpcom/io/Makefile.in b/xpcom/io/Makefile.in
--- a/xpcom/io/Makefile.in
+++ b/xpcom/io/Makefile.in
@@ -88,7 +88,12 @@
 CPPSRCS		+= nsLocalFileOS2.cpp
 else
 ifeq ($(MOZ_WIDGET_TOOLKIT),cocoa)
+ifdef IPHONE
+CPPSRCS		+= nsLocalFileUnix.cpp
+CMMSRCS		+= iPhoneHelpers.mm
+else
 CMMSRCS		= nsLocalFileOSX.mm
+endif
 else
 ifeq ($(MOZ_WIDGET_TOOLKIT),windows)
 CPPSRCS		+= nsLocalFileWin.cpp
@@ -117,7 +122,11 @@
 EXPORTS		+= nsLocalFileOS2.h
 else
 ifeq ($(MOZ_WIDGET_TOOLKIT),cocoa)
+ifdef IPHONE
+EXPORTS		+= nsLocalFileUnix.h
+else
 EXPORTS		+= nsLocalFileOSX.h
+endif
 else
 ifeq ($(MOZ_WIDGET_TOOLKIT),windows)
 EXPORTS		+= nsLocalFileWin.h
diff --git a/xpcom/io/SpecialSystemDirectory.cpp b/xpcom/io/SpecialSystemDirectory.cpp
--- a/xpcom/io/SpecialSystemDirectory.cpp
+++ b/xpcom/io/SpecialSystemDirectory.cpp
@@ -97,6 +97,10 @@
 
 #if defined(VMS)
 #include <unixlib.h>
+#endif
+
+#if defined(IPHONE)
+#include "iPhoneHelpers.h"
 #endif
 
 #ifndef MAXPATHLEN
@@ -548,6 +552,10 @@
             }
             return NS_NewNativeLocalFile(tString, PR_TRUE, aFile);
         }
+#elif defined(IPHONE)
+        {
+            return GetTemporaryFolder(aFile);
+        }
 #elif defined(XP_MACOSX)
         {
             return GetOSXFolderType(kUserDomain, kTemporaryFolderType, aFile);
@@ -898,7 +906,7 @@
     return NS_ERROR_NOT_AVAILABLE;
 }
 
-#if defined (XP_MACOSX)
+#if defined (XP_MACOSX) && !defined(IPHONE)
 nsresult
 GetOSXFolderType(short aDomain, OSType aFolderType, nsILocalFile **localFile)
 {
diff --git a/xpcom/io/SpecialSystemDirectory.h b/xpcom/io/SpecialSystemDirectory.h
--- a/xpcom/io/SpecialSystemDirectory.h
+++ b/xpcom/io/SpecialSystemDirectory.h
@@ -44,7 +44,7 @@
 #include "nscore.h"
 #include "nsILocalFile.h"
 
-#ifdef XP_MACOSX
+#if defined(XP_MACOSX) && !defined(IPHONE)
 #include <Types.h>
 #include "nsILocalFileMac.h"
 #include "prenv.h"
@@ -137,7 +137,7 @@
 nsresult
 GetSpecialSystemDirectory(SystemDirectories aSystemSystemDirectory,
                           nsILocalFile** aFile);
-#ifdef XP_MACOSX
+#if defined(XP_MACOSX) && !defined(IPHONE)
 nsresult
 GetOSXFolderType(short aDomain, OSType aFolderType, nsILocalFile **localFile);
 #endif
diff --git a/xpcom/io/iPhoneHelpers.h b/xpcom/io/iPhoneHelpers.h
new file mode 100644
--- /dev/null
+++ b/xpcom/io/iPhoneHelpers.h
@@ -0,0 +1,2 @@
+
+nsresult GetTemporaryFolder(nsILocalFile** file);
diff --git a/xpcom/io/iPhoneHelpers.mm b/xpcom/io/iPhoneHelpers.mm
new file mode 100644
--- /dev/null
+++ b/xpcom/io/iPhoneHelpers.mm
@@ -0,0 +1,10 @@
+#include <Foundation/NSPathUtilities.h>
+
+#include "nsString.h"
+#include "nsILocalFile.h"
+
+nsresult GetTemporaryFolder(nsILocalFile** aFile)
+{
+  return NS_NewNativeLocalFile(nsDependentCString([NSTemporaryDirectory() UTF8String]),
+                               PR_TRUE, aFile);
+}
diff --git a/xpcom/io/nsAppFileLocationProvider.cpp b/xpcom/io/nsAppFileLocationProvider.cpp
--- a/xpcom/io/nsAppFileLocationProvider.cpp
+++ b/xpcom/io/nsAppFileLocationProvider.cpp
@@ -49,11 +49,13 @@
 #include "nsCRT.h"
 
 #if defined(XP_MACOSX)
+#ifndef IPHONE
 #include <Folders.h>
 #include <Script.h>
 #include <Processes.h>
 #include <Gestalt.h>
 #include "nsILocalFileMac.h"
+#endif
 #elif defined(XP_OS2)
 #define INCL_DOSPROCESS
 #define INCL_DOSMODULEMGR
@@ -135,7 +137,7 @@
     *_retval = nsnull;
     *persistent = PR_TRUE;
 
-#ifdef XP_MACOSX
+#if defined(XP_MACOSX) && !defined(IPHONE)
     short foundVRefNum;
     long foundDirID;
     FSSpec fileSpec;
@@ -203,7 +205,11 @@
         if (NS_SUCCEEDED(rv))
             rv = localFile->AppendRelativeNativePath(PLUGINS_DIR_NAME);
     }
-#ifdef XP_MACOSX
+
+#if defined(IPHONE)
+    // Anything specific here?
+
+#elif defined(XP_MACOSX)
     else if (nsCRT::strcmp(prop, NS_MACOSX_USER_PLUGIN_DIR) == 0)
     {
         if (!(::FindFolder(kUserDomain,
@@ -339,7 +345,7 @@
     PRBool exists;
     nsCOMPtr<nsILocalFile> localDir;
 
-#if defined(XP_MACOSX)
+#if defined(XP_MACOSX) && !defined(IPHONE)
     FSRef fsRef;
     OSType folderType = aLocal ? kCachedDataFolderType : kDomainLibraryFolderType;
     OSErr err = ::FSFindFolder(kUserDomain, folderType, kCreateFolder, &fsRef);
@@ -578,7 +584,9 @@
     
     if (!nsCRT::strcmp(prop, NS_APP_PLUGINS_DIR_LIST))
     {
-#ifdef XP_MACOSX
+#if defined(IPHONE)
+        // anything here?
+#elif defined(XP_MACOSX)
         static const char* osXKeys[] = { NS_APP_PLUGINS_DIR, NS_MACOSX_USER_PLUGIN_DIR, NS_MACOSX_LOCAL_PLUGIN_DIR, nsnull };
         static const char* os9Keys[] = { NS_APP_PLUGINS_DIR, NS_MAC_CLASSIC_PLUGIN_DIR, nsnull };
         static const char** keys;
diff --git a/xpcom/io/nsDirectoryService.cpp b/xpcom/io/nsDirectoryService.cpp
--- a/xpcom/io/nsDirectoryService.cpp
+++ b/xpcom/io/nsDirectoryService.cpp
@@ -60,15 +60,18 @@
 #include <stdlib.h>
 #include <sys/param.h>
 #include "prenv.h"
-#ifdef XP_MACOSX
+#if defined(XP_MACOSX)
+#ifndef IPHONE
 #include <CoreServices/CoreServices.h>
 #include <Folders.h>
 #include <Files.h>
 #include <Memory.h>
 #include <Processes.h>
 #include <Gestalt.h>
-#include <CFURL.h>
 #include <InternetConfig.h>
+#endif
+#include <CoreFoundation/CFBundle.h>
+#include <CoreFoundation/CFURL.h>
 #endif
 #elif defined(XP_OS2)
 #define MAX_PATH _MAX_PATH
@@ -295,7 +298,7 @@
 nsIAtom*  nsDirectoryService::sOS_CurrentWorkingDirectory = nsnull;
 nsIAtom*  nsDirectoryService::sOS_DesktopDirectory = nsnull;
 nsIAtom*  nsDirectoryService::sOS_HomeDirectory = nsnull;
-#if defined (XP_MACOSX)
+#if defined (XP_MACOSX) && !defined(IPHONE)
 nsIAtom*  nsDirectoryService::sDirectory = nsnull;
 nsIAtom*  nsDirectoryService::sTrashDirectory = nsnull;
 nsIAtom*  nsDirectoryService::sStartupDirectory = nsnull;
@@ -411,7 +414,9 @@
     { NS_OS_HOME_DIR,              &nsDirectoryService::sOS_HomeDirectory },
     { NS_OS_DESKTOP_DIR,           &nsDirectoryService::sOS_DesktopDirectory },
     { NS_XPCOM_INIT_CURRENT_PROCESS_DIR, nsnull },
-#if defined (XP_MACOSX)
+#if defined(IPHONE)
+    // Anything? 
+#elif defined (XP_MACOSX)
     { NS_OS_SYSTEM_DIR,                   &nsDirectoryService::sDirectory },
     { NS_MAC_TRASH_DIR,                   &nsDirectoryService::sTrashDirectory },
     { NS_MAC_STARTUP_DIR,                 &nsDirectoryService::sStartupDirectory },
@@ -861,7 +866,7 @@
         rv = GetSpecialSystemDirectory(OS_CurrentWorkingDirectory, getter_AddRefs(localFile)); 
     }
        
-#if defined(XP_MACOSX)
+#if defined(XP_MACOSX) && !defined(IPHONE)
     else if (inAtom == nsDirectoryService::sDirectory)
     {
         rv = GetOSXFolderType(kClassicDomain, kSystemFolderType, getter_AddRefs(localFile));
diff --git a/xpcom/io/nsDirectoryService.h b/xpcom/io/nsDirectoryService.h
--- a/xpcom/io/nsDirectoryService.h
+++ b/xpcom/io/nsDirectoryService.h
@@ -97,7 +97,7 @@
     static nsIAtom *sOS_CurrentWorkingDirectory;
     static nsIAtom *sOS_DesktopDirectory;
     static nsIAtom *sOS_HomeDirectory;
-#if defined (XP_MACOSX)
+#if defined (XP_MACOSX) && !defined(IPHONE)
     static nsIAtom *sDirectory;
     static nsIAtom *sTrashDirectory;
     static nsIAtom *sStartupDirectory;
diff --git a/xpcom/io/nsILocalFileMac.idl b/xpcom/io/nsILocalFileMac.idl
--- a/xpcom/io/nsILocalFileMac.idl
+++ b/xpcom/io/nsILocalFileMac.idl
@@ -41,7 +41,7 @@
 
 %{C++
 #include <Files.h>
-#include <CFURL.h>
+#include <CoreFoundation/CFURL.h>
 %}
 
       native OSType(OSType);
diff --git a/xpcom/io/nsLocalFile.h b/xpcom/io/nsLocalFile.h
--- a/xpcom/io/nsLocalFile.h
+++ b/xpcom/io/nsLocalFile.h
@@ -72,7 +72,7 @@
 
 #ifdef XP_WIN
 #include "nsLocalFileWin.h"
-#elif defined(XP_MACOSX)
+#elif defined(XP_MACOSX) && !defined(IPHONE)
 #include "nsLocalFileOSX.h"
 #elif defined(XP_UNIX) || defined(XP_BEOS)
 #include "nsLocalFileUnix.h"
diff --git a/xpcom/threads/nsProcessCommon.cpp b/xpcom/threads/nsProcessCommon.cpp
--- a/xpcom/threads/nsProcessCommon.cpp
+++ b/xpcom/threads/nsProcessCommon.cpp
@@ -63,7 +63,7 @@
 #include <windows.h>
 #endif
 
-#if defined(XP_MACOSX)
+#if defined(XP_MACOSX) && !defined(IPHONE)
 #include <Processes.h>
 #include "nsILocalFileMac.h"
 #endif
@@ -310,7 +310,7 @@
 
 #else // Note, this must not be an #elif ...!
 
-#if defined(XP_MACOSX)
+#if defined(XP_MACOSX) && !defined(IPHONE)
     if (count == 0) {
         FSSpec resolvedSpec;
         OSErr err = noErr;
